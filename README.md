# Backend åŽç«¯æœåŠ¡

åŸºäºŽ Bun + Elysia æž„å»ºçš„é«˜æ€§èƒ½åŽç«¯æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç†ã€VIP ä¼šå‘˜ç­‰åŠŸèƒ½ã€‚

## æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Bun
- **Web æ¡†æž¶**: Elysia
- **æ•°æ®åº“**: SQLite / MySQL / PostgreSQL
- **ORM**: è‡ªç ”è½»é‡çº§ ORM
- **SQL æž„å»ºå™¨**: è‡ªç ” SSQL (Simple SQL)

---

## Auth æ¨¡å— (è®¤è¯)

ç”¨æˆ·èº«ä»½è®¤è¯æ¨¡å—ï¼Œæä¾›å®‰å…¨å¯é çš„ç™»å½•æ³¨å†Œä½“ç³»ã€‚

### åŠŸèƒ½ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜Ž |
|------|------|
| ðŸ” å®‰å…¨å¯†ç å­˜å‚¨ | ä½¿ç”¨ Bun å†…ç½®é«˜æ€§èƒ½å“ˆå¸Œç®—æ³• |
| ðŸŽ« Token ä¼šè¯ç®¡ç† | æ”¯æŒä¼šè¯åˆ›å»ºã€éªŒè¯ã€åˆ·æ–°ã€é”€æ¯ |
| ðŸšª çµæ´»çš„è·¯ç”±ä¿æŠ¤ | å£°æ˜Žå¼é…ç½®ï¼ŒæŒ‰éœ€è·³è¿‡è®¤è¯ |
| ðŸŒ è‡ªåŠ¨ä¸Šä¸‹æ–‡æ³¨å…¥ | è‡ªåŠ¨å‘è·¯ç”±æ³¨å…¥ `userId`ã€`session`ã€`roleId` |
| âš™ï¸ å¯å®šåˆ¶ Token æå– | æ”¯æŒè‡ªå®šä¹‰ Token æå–é€»è¾‘ |
| ðŸ“‹ è·¯å¾„ç™½åå• | æ”¯æŒé€šé…ç¬¦çš„å…è®¤è¯è·¯å¾„é…ç½® |

### æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | æè¿° |
|------|------|
| **é›¶é…ç½®å¯ç”¨** | æ’ä»¶æ³¨å†Œå³ç”Ÿæ•ˆï¼Œé»˜è®¤ä¿æŠ¤æ‰€æœ‰è·¯ç”± |
| **å£°æ˜Žå¼æŽ§åˆ¶** | é€šè¿‡è·¯ç”±é…ç½® `skipAuth: true` è½»æ¾è·³è¿‡è®¤è¯ |
| **é«˜æ€§èƒ½** | åŸºäºŽå†…å­˜ä¼šè¯å­˜å‚¨ï¼Œæ¯«ç§’çº§éªŒè¯ |
| **å®‰å…¨æ€§** | è‡ªåŠ¨é˜²æ­¢æ—¶åºæ”»å‡»çš„å¯†ç éªŒè¯ |

### æä¾›çš„ API

| æŽ¥å£ | è¯´æ˜Ž |
|------|------|
| ç”¨æˆ·ç™»å½• | ç”¨æˆ·åå¯†ç éªŒè¯ï¼Œè¿”å›ž Token |
| ç”¨æˆ·æ³¨å†Œ | æ–°ç”¨æˆ·åˆ›å»ºï¼Œè‡ªåŠ¨å¯†ç å“ˆå¸Œ |
| ç”¨æˆ·ç™»å‡º | é”€æ¯ä¼šè¯ Token |
| Token åˆ·æ–° | å»¶é•¿ä¼šè¯æœ‰æ•ˆæœŸ |
| èŽ·å–ä¸ªäººä¿¡æ¯ | èŽ·å–å½“å‰ç™»å½•ç”¨æˆ·èµ„æ–™ |
| ä¿®æ”¹å¯†ç  | å®‰å…¨æ›´æ–°ç”¨æˆ·å¯†ç  |

---

## RBAC æ¨¡å— (æƒé™æŽ§åˆ¶)

åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶æ¨¡å—ï¼Œå®žçŽ°ä¼ä¸šçº§æƒé™ç®¡ç†ã€‚

### åŠŸèƒ½ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜Ž |
|------|------|
| ðŸŒ³ æ ‘å½¢è§’è‰²ç»“æž„ | æ”¯æŒæ— é™å±‚çº§çš„è§’è‰²ç»§æ‰¿ |
| â¬†ï¸ æƒé™å‘ä¸Šæ±‡èš | çˆ¶è§’è‰²è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰å­è§’è‰²æƒé™ |
| ðŸŽ¯ ç»†ç²’åº¦æƒé™ç‚¹ | æ”¯æŒ `æ¨¡å—:æ“ä½œ` æ ¼å¼çš„æƒé™ç¼–ç  |
| ðŸ“‹ åŠ¨æ€èœå• | æ ¹æ®è§’è‰²è‡ªåŠ¨ç”Ÿæˆå‰ç«¯èœå•æ ‘ |
| ðŸ” æ•°æ®æƒé™è¿‡æ»¤ | åŸºäºŽ SSQL çš„è¡Œçº§æ•°æ®éš”ç¦» |
| âš¡ é«˜æ€§èƒ½ç¼“å­˜ | å…¨é‡ç¼“å­˜é¢„çƒ­ï¼ŒæŸ¥è¯¢é›¶æ•°æ®åº“è®¿é—® |

### æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | æè¿° |
|------|------|
| **æƒé™ç»§æ‰¿è‡ªåŠ¨åŒ–** | çˆ¶è§’è‰² = è‡ªèº« âˆª æ‰€æœ‰åŽä»£è§’è‰²æƒé™ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤ |
| **å£°æ˜Žå¼æƒé™æ£€æŸ¥** | è·¯ç”±é…ç½® `permissions` æˆ– `roles` å³å¯å¯ç”¨æ£€æŸ¥ |
| **æ•°æ®æƒé™é€æ˜Ž** | è‡ªåŠ¨æ³¨å…¥ `dataScope`ï¼ŒèŽ·å–å½“å‰ç”¨æˆ·çš„æ•°æ®è¿‡æ»¤è§„åˆ™ |
| **ç¼“å­˜å…¨è¦†ç›–** | è§’è‰²æ ‘ã€æƒé™ã€èœå•ã€æ•°æ®è§„åˆ™ä¸€æ¬¡åŠ è½½ï¼Œå…¨ç¨‹é«˜é€Ÿ |
| **çµæ´»æŸ¥è¯¢** | æ”¯æŒå•æƒé™ã€ä»»ä¸€æƒé™ã€å…¨éƒ¨æƒé™å¤šç§æ£€æŸ¥æ¨¡å¼ |

### æƒé™æ¨¡åž‹

| æ¦‚å¿µ | è¯´æ˜Ž |
|------|------|
| **è§’è‰² (Role)** | æ ‘å½¢ç»“æž„ï¼Œæ”¯æŒæ— é™å±‚çº§ç»§æ‰¿ |
| **æƒé™ (Permission)** | åŠŸèƒ½æƒé™ç‚¹ï¼Œå¦‚ `user:read`, `user:write` |
| **èœå• (Menu)** | ä¸Žè§’è‰²ç»‘å®šï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¼èˆªæ ‘ |
| **æ•°æ®æƒé™ (Scope)** | SSQL è¡¨è¾¾å¼ï¼Œå®žçŽ°è¡Œçº§æ•°æ®éš”ç¦» |

### æä¾›çš„ API

| æŽ¥å£ | è¯´æ˜Ž |
|------|------|
| èŽ·å–ç”¨æˆ·æƒé™åˆ—è¡¨ | å½“å‰ç”¨æˆ·æ‰€æœ‰æƒé™ç¼–ç  |
| èŽ·å–ç”¨æˆ·èœå•æ ‘ | å½“å‰ç”¨æˆ·å¯è®¿é—®çš„èœå•ç»“æž„ |
| æƒé™æ£€æŸ¥ | å•ä¸ª/å¤šä¸ªæƒé™æ ¡éªŒ |
| è§’è‰²/æƒé™/èœå•ç®¡ç† | å®Œæ•´çš„ CRUD ç®¡ç†æŽ¥å£ |

---

## VIP æ¨¡å— (ä¼šå‘˜ç³»ç»Ÿ)

å®Œæ•´çš„ä¼šå‘˜ç­‰çº§ä¸Žèµ„æºé…é¢ç®¡ç†æ¨¡å—ã€‚

### åŠŸèƒ½ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜Ž |
|------|------|
| ðŸ† å¤šç­‰çº§ä½“ç³» | æ”¯æŒå…è´¹ç‰ˆã€ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆç­‰å¤šçº§ä¼šå‘˜ |
| ðŸ“Š èµ„æºé…é¢ç®¡ç† | æŒ‰ç­‰çº§é…ç½®å­˜å‚¨ã€API è°ƒç”¨ç­‰èµ„æºé™åˆ¶ |
| ðŸ“ˆ ä½¿ç”¨é‡è¿½è¸ª | å®žæ—¶è®°å½•ç”¨æˆ·èµ„æºä½¿ç”¨æƒ…å†µ |
| â° æœ‰æ•ˆæœŸç®¡ç† | æ”¯æŒ VIP åˆ°æœŸè‡ªåŠ¨å¤±æ•ˆ |
| ðŸ”„ ç»‘å®šçŠ¶æ€æœº | ç»‘å®šã€ç¡®è®¤ã€è§£ç»‘å®Œæ•´çŠ¶æ€æµè½¬ |
| ðŸª å›žè°ƒé’©å­ | ç»‘å®š/è§£ç»‘äº‹ä»¶æ”¯æŒè‡ªå®šä¹‰å›žè°ƒ |

### æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | æè¿° |
|------|------|
| **å£°æ˜Žå¼ VIP æ£€æŸ¥** | è·¯ç”±é…ç½®ç­‰çº§è¦æ±‚ï¼Œè‡ªåŠ¨æ‹¦æˆªéžä¼šå‘˜ |
| **ä¸Šä¸‹æ–‡è‡ªåŠ¨æ³¨å…¥** | è‡ªåŠ¨æ³¨å…¥ `vip` å¯¹è±¡ï¼ŒåŒ…å«å®Œæ•´ä¼šå‘˜ä¿¡æ¯ |
| **ä¾¿æ·èµ„æºæŽ§åˆ¶** | `canUseResource` / `incrementResource` ä¸€è¡Œæžå®šé…é¢æ£€æŸ¥ |
| **çµæ´»èµ„æºæ¨¡åž‹** | ä»»æ„ Key-Value å½¢å¼å®šä¹‰èµ„æºç±»åž‹ |
| **ç²¾ç¡®ç”¨é‡ç»Ÿè®¡** | æ”¯æŒå¢žé‡ã€å‡é‡ã€æŸ¥è¯¢å¤šç§æ“ä½œ |

### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜Ž |
|------|------|
| **VIP ç­‰çº§ (Tier)** | ä¼šå‘˜ç­‰çº§å®šä¹‰ï¼ŒåŒ…å«ä»£ç ã€åç§°ã€æŽ’åº |
| **èµ„æºé™åˆ¶ (ResourceLimit)** | å„ç­‰çº§å¯¹åº”çš„èµ„æºé…é¢ |
| **ç”¨æˆ· VIP (UserVip)** | ç”¨æˆ·ä¼šå‘˜è®°å½•ï¼ŒåŒ…å«ç­‰çº§ã€æœ‰æ•ˆæœŸã€çŠ¶æ€ |
| **èµ„æºä½¿ç”¨é‡ (ResourceUsage)** | ç”¨æˆ·å½“å‰èµ„æºæ¶ˆè€—ç»Ÿè®¡ |

### VIP ä¸Šä¸‹æ–‡èƒ½åŠ›

| èƒ½åŠ› | è¯´æ˜Ž |
|------|------|
| ç­‰çº§ä¿¡æ¯èŽ·å– | èŽ·å–å½“å‰ç”¨æˆ· VIP ç­‰çº§ IDã€ä»£ç  |
| æœ‰æ•ˆæ€§åˆ¤æ–­ | å¿«é€Ÿåˆ¤æ–­æ˜¯å¦ä¸ºæœ‰æ•ˆ VIP |
| èµ„æºå¯ç”¨æ£€æŸ¥ | æ£€æŸ¥æŒ‡å®šèµ„æºæ˜¯å¦è¿˜æœ‰é…é¢ |
| èµ„æºä½¿ç”¨è®°å½• | å¢žåŠ /å‡å°‘èµ„æºä½¿ç”¨é‡ |
| ä½¿ç”¨è¯¦æƒ…æŸ¥è¯¢ | èŽ·å–èµ„æºçš„ä½¿ç”¨é‡ã€é™é¢ã€å‰©ä½™é‡ |

---

## ORM æ¨¡å— (å¯¹è±¡å…³ç³»æ˜ å°„)

è‡ªç ”è½»é‡çº§ ORM æ¡†æž¶ï¼Œç±»åž‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œä½“éªŒã€‚

### åŠŸèƒ½ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜Ž |
|------|------|
| ðŸŽ¯ å®Œæ•´ç±»åž‹æŽ¨å¯¼ | Schema å®šä¹‰è‡ªåŠ¨æŽ¨å¯¼ Rowã€Insertã€Update ç±»åž‹ |
| ðŸ”— é“¾å¼åˆ—é…ç½® | ä¸»é”®ã€è‡ªå¢žã€é»˜è®¤å€¼ã€å¤–é”®ç­‰é“¾å¼é…ç½® |
| ðŸ“¦ å¤šç§ Schema åŸºç±» | é¢„ç½®æ—¶é—´æˆ³ã€å¤‡æ³¨ç­‰å¸¸ç”¨å­—æ®µç»„åˆ |
| ðŸ”„ è‡ªåŠ¨è¡¨åŒæ­¥ | å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»º/æ›´æ–°è¡¨ç»“æž„ |
| ðŸ—„ï¸ å¤šæ•°æ®åº“æ”¯æŒ | SQLiteã€MySQLã€PostgreSQL ä¸€å¥—ä»£ç  |
| ðŸ”§ è‡ªå®šä¹‰åºåˆ—åŒ– | æ”¯æŒå­—æ®µè¯»å†™æ—¶è‡ªåŠ¨è½¬æ¢ |

### æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | æè¿° |
|------|------|
| **æžç®€ API** | `create` / `findOne` / `update` / `delete` ç›´è§‚æ˜“ç”¨ |
| **ç±»åž‹é›¶æˆæœ¬** | TypeScript ç±»åž‹å®Œå…¨æŽ¨å¯¼ï¼Œæ— éœ€æ‰‹åŠ¨å£°æ˜Ž |
| **Schema å³æ–‡æ¡£** | è¡¨ç»“æž„å®šä¹‰æ¸…æ™°å¯è¯»ï¼Œä¸€ç›®äº†ç„¶ |
| **çµæ´»æŸ¥è¯¢** | æ”¯æŒ Builder å’Œ SSQL å­—ç¬¦ä¸²ä¸¤ç§æ¡ä»¶æ–¹å¼ |
| **æ‰¹é‡æ“ä½œ** | åŽŸç”Ÿæ”¯æŒæ‰¹é‡åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ |
| **åŽŸå§‹ SQL** | ä¿ç•™ `raw` æ–¹æ³•åº”å¯¹å¤æ‚åœºæ™¯ |

### åˆ—ç±»åž‹æ”¯æŒ

| ç±»åž‹ | è¯´æ˜Ž |
|------|------|
| `string` | å­—ç¬¦ä¸²ï¼Œæ”¯æŒé•¿åº¦é…ç½® |
| `number` | æ•°å­—ï¼Œæ”¯æŒç²¾åº¦é…ç½® |
| `boolean` | å¸ƒå°”å€¼ |
| `date` | æ—¥æœŸæ—¶é—´ |
| `json` | JSON å¯¹è±¡ï¼Œæ”¯æŒæ³›åž‹ |

### åˆ—é…ç½®èƒ½åŠ›

| é…ç½® | è¯´æ˜Ž |
|------|------|
| ä¸»é”® & è‡ªå¢ž | `primaryKey()` / `autoIncrement()` |
| ç©ºå€¼ & é»˜è®¤ | `nullable()` / `default(value)` |
| çº¦æŸ | `unique()` / `index()` |
| å¤–é”® | `references(table, column)` |
| ç±»åž‹ç»†èŠ‚ | `length()` / `precision()` |

### Schema åŸºç±»

| åŸºç±» | åŒ…å«å­—æ®µ |
|------|----------|
| `Schema` | æ— é¢å¤–å­—æ®µ |
| `TimestampSchema` | `createdAt`, `updatedAt` |
| `BaseSchema` | æ—¶é—´æˆ³ + `remark` |

---

## SSQL æ¨¡å— (SQL æ¡ä»¶æž„å»ºå™¨)

é›¶ä¾èµ–ã€é«˜æ€§èƒ½çš„ SQL æ¡ä»¶æž„å»ºå™¨ï¼Œæ”¯æŒåŒå‘è½¬æ¢ã€‚

### åŠŸèƒ½ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜Ž |
|------|------|
| ðŸš€ é›¶ä¾èµ– | çº¯ TypeScript å®žçŽ°ï¼Œæ— å¤–éƒ¨ä¾èµ– |
| ðŸ”— é“¾å¼ API | æµç•…çš„ Builder æ¨¡å¼æž„å»ºæ¡ä»¶ |
| ðŸ“ å­—ç¬¦ä¸²è§£æž | æ”¯æŒ SSQL è¯­æ³•å­—ç¬¦ä¸²è§£æž |
| ðŸ”„ åŒå‘è½¬æ¢ | å¯¹è±¡ â†” SSQL å­—ç¬¦ä¸² â†” æ•°æ®åº“ SQL |
| ðŸ—„ï¸ å¤šæ•°æ®åº“ | MySQL / PostgreSQL / SQLite æ–¹è¨€æ”¯æŒ |
| ðŸ›¡ï¸ è‡ªåŠ¨è½¬ä¹‰ | å†…ç½® SQL æ³¨å…¥é˜²æŠ¤ |

### æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | æè¿° |
|------|------|
| **ä¸¤ç§é£Žæ ¼è‡ªç”±é€‰** | Builder é“¾å¼è°ƒç”¨æˆ– SSQL å­—ç¬¦ä¸²ï¼ŒæŒ‰éœ€é€‰æ‹© |
| **ç±»åž‹å®‰å…¨** | å®Œæ•´ TypeScript ç±»åž‹æ”¯æŒ |
| **å¯è¯»æ€§å¼º** | SSQL è¯­æ³•ç®€æ´ç›´è§‚ï¼Œå¦‚ `age > 18 && status = 1` |
| **ORM æ— ç¼é›†æˆ** | ç›´æŽ¥ä¼ å…¥ ORM çš„ where æ¡ä»¶ |
| **å®‰å…¨å¯é ** | è‡ªåŠ¨è½¬ä¹‰é˜²æ­¢ SQL æ³¨å…¥ |
| **çµæ´»è¾“å‡º** | å¯è¾“å‡ºå¸¦å ä½ç¬¦çš„å‚æ•°åŒ– SQL |

### SSQL è¿ç®—ç¬¦

| è¿ç®—ç¬¦ | å«ä¹‰ | ç¤ºä¾‹ |
|--------|------|------|
| `=` / `!=` | ç­‰äºŽ / ä¸ç­‰äºŽ | `status = 1` |
| `>` / `>=` / `<` / `<=` | æ¯”è¾ƒè¿ç®— | `age > 18` |
| `~` / `!~` | LIKE / NOT LIKE | `name ~ 'å¼ '` |
| `?=` / `!?=` | IN / NOT IN | `id ?= [1, 2, 3]` |
| `?null` / `!null` | NULL æ£€æŸ¥ | `email ?null` |
| `><` | BETWEEN | `age >< [18, 60]` |
| `&&` / `\|\|` | AND / OR | `a = 1 && b = 2` |

### ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›

| èƒ½åŠ› | æ–¹å‘ | è¯´æ˜Ž |
|------|------|------|
| **åºåˆ—åŒ–** | å¯¹è±¡ â†’ SSQL å­—ç¬¦ä¸² | å­˜å‚¨åˆ°æ•°æ®åº“ã€é…ç½®æ–‡ä»¶ |
| **ç¼–è¯‘** | å¯¹è±¡ â†’ æ•°æ®åº“ SQL | æ‰§è¡ŒæŸ¥è¯¢ |
| **ååºåˆ—åŒ–** | SSQL å­—ç¬¦ä¸² â†’ å¯¹è±¡ | ä»Žé…ç½®è¯»å–ã€å‰ç«¯ä¼ å‚ |

### å…¸åž‹åœºæ™¯

| åœºæ™¯ | è¯´æ˜Ž |
|------|------|
| åŠ¨æ€æŸ¥è¯¢æž„å»º | æ ¹æ®æ¡ä»¶æ‹¼æŽ¥ WHERE å­å¥ |
| æ•°æ®æƒé™è¿‡æ»¤ | RBAC æ¨¡å—ä½¿ç”¨ SSQL å®šä¹‰è¡Œçº§è¿‡æ»¤è§„åˆ™ |
| é…ç½®åŒ–æŸ¥è¯¢ | å°†æŸ¥è¯¢æ¡ä»¶å­˜å‚¨ä¸º SSQL å­—ç¬¦ä¸² |
| å‰ç«¯ä¼ å‚ | å‰ç«¯ç›´æŽ¥ä¼  SSQL å­—ç¬¦ä¸²ï¼ŒåŽç«¯å®‰å…¨è§£æž |

---

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
bun install
```

### å¯åŠ¨å¼€å‘æœåŠ¡

```bash
bun run dev
```

### ç”Ÿäº§æž„å»º

```bash
bun run build
```

## è®¸å¯è¯

MIT
